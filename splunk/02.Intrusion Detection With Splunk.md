- check log sources - `index="main" | stats count by sourcetype`
- parent children where children is ps or cmd - `index="main" sourcetype="WinEventLog:Sysmon" EventCode=1 (Image="*cmd.exe" OR Image="*powershell.exe") | stats count by ParentImage, Image`
- check for suspicious connections - `index="main" 10.0.0.229 sourcetype="WinEventLog:sysmon" | stats count by CommandLine`
- DCSync attack check - `index="main" EventCode=4662 Access_Mask=0x100 Account_Name!=*$`
- check what accessed "lsass" - `index="main" EventCode=10 lsass | stats count by SourceImage`

## Creating Meaningful Alerts
### create an alert that can detect threat actors based on them making calls from UNKNOWN memory regions
- listing all the call stacks containing UNKNOWN - `index="main" CallTrace="*UNKNOWN*" | stats count by EventCode`
- group by SourceImage - `index="main" CallTrace="*UNKNOWN*" | stats count by SourceImage`
- filter process accessing itself -  `index="main" CallTrace="*UNKNOWN*" | where SourceImage!=TargetImage | stats count by SourceImage`
- filter C and .NET - `index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* | where SourceImage!=TargetImage | stats count by SourceImage`
- filter WOW64 - `index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* | where SourceImage!=TargetImage | stats count by SourceImage`
- filter Explorer.exe - `index="main" CallTrace="*UNKNOWN*" SourceImage!="*Microsoft.NET*" CallTrace!=*ni.dll* CallTrace!=*clr.dll* CallTrace!=*wow64* SourceImage!="C:\\Windows\\Explorer.EXE" | where SourceImage!=TargetImage | stats count by SourceImage`
